---
title: "Tour Frequency"
output: html_document
date: "2024-03-21"
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
options(dplyr.summarise.inform = FALSE)
options(scipen = 999)

library(tidyverse)
library(knitr)
library(scales)
library(kableExtra)
library(readxl)
# source("R/eda.R")
```

```{r}
hh <- read_csv("data/_private/hh_survey/output/output_households.csv")
per <- read_csv("data/_private/hh_survey/output/output_persons.csv")
tours <- read_csv("data/_private/hh_survey/output/output_tours.csv")
```

# Create estimation dataset

```{r}
retired <- per %>%
  mutate(
    retired = ifelse(employment == "Retired", 1, 0)
  ) %>%
  group_by(hh_id) %>%
  summarize(retired = max(retired))

# bottom 10% income: $20k
# 25%: $30k (closest breakpoint in the survey)
# 50%: $40k

est_tbl <- hh %>%
  left_join(retired, by = "hh_id") %>%
  mutate(
    life_cycle = case_when(
      retired == 1 ~ 1,
      num_kids > 0 ~ 2,
      TRUE ~ 3
    ),
    income = case_when(
      income_broad == "Under $20,000" ~ 1,
      income_detailed == "$20,000-$29,999" ~ 2,
      income_detailed %in% c("$30,000-$39,999", "$40,000-$49,999") ~ 3,
      TRUE ~ 4
    ),
    size = gsub("(?:\\sperson|\\speople)", "", num_people),
    size = as.numeric(size),
    size = ifelse(size > 5, 5, size),
    workers = gsub("(?:\\sworker|\\sworkers)", "", num_workers),
    workers = as.numeric(workers),
    workers = ifelse(workers > 3, 3, workers)
  ) %>%
  select(hh_id, HomeTAZ, size, workers, life_cycle, income) %>%
  left_join(per %>% select(hh_id, contains("_tours")), by = "hh_id")

# note on area type
# AT 1: CBD
```

```{r, eval=FALSE}
write_csv(est_tbl, "data/_private/hh_survey/output/tour_freq_est.csv")
```

